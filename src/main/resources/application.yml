# Server Configuration
quarkus:
  http:
    port: 8085
  datasource:
    db-kind: oracle
    username: CYA_AAA_OPS
    password: UkkaNk8KnAPp19!
    reactive:
      #url: oracle:thin:@localhost:1521/FREEPDB1
      url: oracle:thin:@172.24.0.203:1908/ORCL
      max-size: 30
      event-loop-size: 20
      idle-timeout: PT150M
      max-lifetime: PT140M
      cache-prepared-statements: true
      reconnect-attempts: 5
      reconnect-interval: PT2S
      shared: false
      name: oracle-pool
      additional-properties:
        oracle.jdbc.implicitStatementCacheSize: "200"
        oracle.jdbc.ReadTimeout: "300000"                  # 5 minutes for large batch operations
        oracle.net.CONNECT_TIMEOUT: "30000"                # Increased to 30s for connection establishment
        oracle.net.READ_TIMEOUT: "300000"                  # Socket-level read timeout (5 minutes)
        oracle.jdbc.loginTimeout: "60"                     # Login timeout in seconds
        oracle.jdbc.defaultRowPrefetch: "5000"
        oracle.net.keepAlive: "true"
    jdbc:
      url: oracle:thin:@localhost:1522/ORCL
      driver: oracle.jdbc.OracleDriver
      max-size: 30
      idle-timeout: PT150M
      max-lifetime: PT140M
      cache-prepared-statements: true
      additional-properties:
        oracle.jdbc.implicitStatementCacheSize: "200"
        oracle.jdbc.ReadTimeout: "300000"
        oracle.net.CONNECT_TIMEOUT: "30000"
        oracle.net.READ_TIMEOUT: "300000"
        oracle.jdbc.loginTimeout: "60"
        oracle.jdbc.defaultRowPrefetch: "5000"
        oracle.net.keepAlive: "true"


  console:
    color: true
  log:
    level: DEBUG
    file:
      path: /var/log/db-write/db-write.log
      format: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n"
      rotation:
        max-file-size: 100M
        max-backup-index: 10
        rotate-on-boot: true
    console:
      format: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n"
    category:
      "org.apache.kafka":
        level: WARN
      "io.smallrye.reactive.messaging.kafka":
        level: DEBUG
      "io.quarkus.config":
        level: DEBUG
      "io.smallrye.config":
        level: DEBUG
      "com.csg.airtel.aaa4j":
        level: DEBUG

#  redis:
#    client-type: sentinel
#    hosts: redis://redis-cluster.cluster-redis.svc.cluster.local:26379
#    master-name: mymaster
#    role: master
#    password: AAAtest_Redis_Pass_w0rd!
#    max-pool-size: 300
#    max-waiting-handlers: 5000
#    max-pool-waiting: 800
#    pool-recycle-timeout: 240000
#    reconnect-attempts: 3
#    reconnect-interval: 500
#    pool-cleaner-interval: 20000
#    timeout: 60000

  redis:
    hosts: redis://localhost:6379
    max-pool-size: 600
    max-waiting-handlers: 12000
    max-pool-waiting: 3000
    pool-recycle-timeout: 240000
    reconnect-attempts: 3
    reconnect-interval: 500
    pool-cleaner-interval: 20000
    response-timeout: 3000
    connection-timeout: 2000

pool:
  max-size: 50                      # Max connections
  connection-timeout: 5000          # 5 seconds to acquire connection
  idle-timeout: 600000              # 10 minutes idle before closing
  max-lifetime: 1800000             # 30 minutes max connection lifetime
  acquire-increment: 4              # Connections to acquire at once
  prepared-statement-cache-max-size: 256  # Cache prepared statements
  pipelining-enabled: true          # Enable query pipelining
  pipelining-limit: 256             # Max pipelined queries
  event-loop-size: 32               # Match vertx event-loops-pool-size
  tcp-keep-alive: true              # Detect dead connections
  tcp-no-delay: true                # Reduce latency
  pool-cleaner-enabled: true        # Clean idle connections
  pool-cleaner-interval: 60000      # Clean every minute

# Kafka Configuration

#kafka:
#  bootstrap:
#    servers: kafka-headless.cluster-dc.svc.cluster.local:9092

mp:
  messaging:
    incoming:
      db-write-events:
        connector: smallrye-kafka
        topic: dctodr-dc
        group.id: accounting-dc-group
        value.deserializer: io.quarkus.kafka.client.serialization.ObjectMapperDeserializer
        key.deserializer: org.apache.kafka.common.serialization.StringDeserializer
        auto.offset.reset: earliest
        enable.auto.commit: false
        max.poll.records: 100
        max.poll.interval.ms: 300000
        session.timeout.ms: 30000
        failure-strategy: ignore


      db-write-events-dr:
        connector: smallrye-kafka
        topic: dc-provisioning
        group.id: accounting-dc-group
        value.deserializer: io.quarkus.kafka.client.serialization.ObjectMapperDeserializer
        value.deserializer.class: com.csg.airtel.aaa4j.domain.model.DBWriteRequest
        value.deserializer.trusted-packages: "*"
        key.deserializer: org.apache.kafka.common.serialization.StringDeserializer
        auto.offset.reset: earliest
        enable.auto.commit: false
        max.poll.records: 100
        max.poll.interval.ms: 300000
        session.timeout.ms: 30000
        failure-strategy: ignore

